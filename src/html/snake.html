<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Snake Z | Arcade-Z</title>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-XXXXXXXXXXXXXXXX" crossorigin="anonymous"></script>
    <style>
        :root {
            --accent: #32ff7e;
            --bg-body: #0f0f11;
            --bg-nav: #1a1a1d;
            --bg-card: #252529;
            --text-main: #ffffff;
            --text-dim: #9ca3af;
        }

        body {
            margin: 0;
            background-color: var(--bg-body);
            color: var(--text-main);
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        nav {
            background: var(--bg-nav);
            height: 65px;
            display: flex;
            align-items: center;
            padding: 0 25px;
            gap: 20px;
            border-bottom: 2px solid #2d2d33;
            z-index: 100;
        }

        .nav-logo {
            font-size: 26px;
            font-weight: 900;
            color: var(--accent);
            text-decoration: none;
            letter-spacing: -1.5px;
            text-transform: uppercase;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 25px;
            padding: 25px;
            flex-grow: 1;
            overflow-y: auto;
        }

        .game-area { display: flex; flex-direction: column; gap: 20px; }

        .viewport-container {
            background: #000;
            width: 100%;
            height: 600px;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 20px 50px rgba(0,0,0,0.6);
            position: relative;
            border: 1px solid #333;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        canvas {
            border: 2px solid var(--accent);
            background: #000;
            box-shadow: 0 0 20px rgba(50, 255, 126, 0.2);
        }

        /* UI OVERLAY */
        #game-ui {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            background: rgba(0,0,0,0.85);
            z-index: 10;
            backdrop-filter: blur(5px);
        }
        .ui-title { font-size: 40px; font-weight: 900; color: var(--accent); margin-bottom: 20px; text-transform: uppercase; letter-spacing: 2px; text-shadow: 0 0 20px var(--accent); }
        .ui-btn {
            padding: 15px 40px; font-size: 18px; font-weight: bold;
            background: var(--accent); color: #000; border: none;
            border-radius: 30px; cursor: pointer; transition: 0.3s;
            text-transform: uppercase;
        }
        .ui-btn:hover { transform: scale(1.1); box-shadow: 0 0 30px var(--accent); color: white; }

        .game-header {
            background: var(--bg-nav);
            padding: 20px;
            border-radius: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .action-btn {
            background: #333338; border: none; color: white; padding: 12px 18px;
            border-radius: 10px; cursor: pointer; font-weight: 600; transition: 0.2s;
        }
        .action-btn:hover { background: var(--accent); color: #000; }

        .sidebar { display: flex; flex-direction: column; gap: 15px; }
        .sidebar-title { color: var(--text-dim); font-size: 12px; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px; }

        .ad-real-container {
            background: #1a1a1d;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid #333;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            min-width: 300px;
        }

        /* Scrollbar */
        .main-content::-webkit-scrollbar { width: 8px; }
        .main-content::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
    </style>
</head>
<body>
    <nav>
        <a href="../../index.html" class="nav-logo">Arcade-Z</a>
        <div style="flex-grow: 1; text-align: center;">
            <span style="color: var(--text-dim); font-size: 14px; text-transform: uppercase; letter-spacing: 2px;">Jugando: Snake Z</span>
        </div>
        <div class="nav-profile-container">
            <span class="nav-user-name">Cargando...</span>
            <canvas id="nav-avatar" width="40" height="40"></canvas>
        </div>
    </nav>

    <div class="main-content">
        <div class="game-area">
            <div class="viewport-container" id="game-vp">
                <div id="game-ui">
                    <div class="ui-title">Snake Z</div>
                    <button class="ui-btn" onclick="startGame()">Jugar Ahora</button>
                    <p style="margin-top: 20px; color: #888; font-size: 14px;">Usa las FLECHAS para moverte</p>
                </div>
                <canvas id="gc" width="400" height="400" tabindex="0"></canvas>
            </div>

            <div class="game-header">
                <div>
                    <h1 style="margin:0; font-size:24px; color:var(--accent);">Snake Z</h1>
                    <p style="margin:5px 0 0; color:var(--text-dim); font-size:14px;">Arcade-Z Originals ‚Ä¢ Cl√°sico</p>
                </div>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <div id="score" style="font-weight: bold; margin-right: 15px;">Score: 0</div>
                    <button class="action-btn" onclick="showMenu()">üîÑ Men√∫</button>
                    <button class="action-btn" onclick="toggleFull()">‚õ∂ Fullscreen</button>
                </div>
            </div>

            <div class="ad-real-container" style="min-height: 100px;">
                <ins class="adsbygoogle" style="display:block; width: 100%;" data-ad-client="ca-pub-XXXXXXXXXXXXXXXX" data-ad-slot="XXXXXXXXXX" data-ad-format="horizontal" data-full-width-responsive="true"></ins>
                <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
            </div>

            <div style="background: var(--bg-nav); padding: 25px; border-radius: 16px;">
                <h3 style="margin-top:0">Sobre Snake Z</h3>
                <p style="color: var(--text-dim); line-height: 1.6;">El cl√°sico juego de la serpiente reinventado con estilo ne√≥n. Come manzanas para crecer, evita chocar contra las paredes o tu propia cola y alcanza la puntuaci√≥n m√°s alta.</p>
            </div>
        </div>

        <div class="sidebar">
            <div class="sidebar-title">Recomendados</div>
            <!-- Se llena con global.js -->
        </div>
    </div>

    <script src="../js/avatar.js"></script>
    <script src="../js/global.js"></script>
    <script>
        function toggleFull() {
            const vp = document.getElementById('game-vp');
            if (!document.fullscreenElement) vp.requestFullscreen();
            else document.exitFullscreen();
        }

        const canvas = document.getElementById('gc');
        const ctx = canvas.getContext('2d');
        let px=10, py=10; // Posici√≥n jugador
        let gs=20, tc=20; // Tama√±o grid y cantidad de tiles
        let ax=15, ay=15; // Posici√≥n manzana
        let xv=0, yv=0;   // Velocidad
        let trail=[];
        let tail = 5;
        let score = 0;
        let intervalId;
        let isPlaying = false;
        const ui = document.getElementById('game-ui');

        document.addEventListener("keydown", keyPush);

        function startGame() {
            isPlaying = true;
            ui.style.display = 'none';
            tail = 5; score = 0;
            px = 10; py = 10;
            xv = 0; yv = 0;
            trail = [];
            document.getElementById('score').innerText = "Score: " + score;
            if(intervalId) clearInterval(intervalId);
            intervalId = setInterval(game, 1000/15);
            canvas.focus();
        }

        function showMenu() {
            isPlaying = false;
            clearInterval(intervalId);
            ui.style.display = 'flex';
            ui.innerHTML = `
                <div class="ui-title">Snake Z</div>
                <button class="ui-btn" onclick="startGame()">Jugar</button>
            `;
        }

        function gameOver() {
            isPlaying = false;
            clearInterval(intervalId);

            const snakeData = JSON.parse(localStorage.getItem('snakeData')) || { highScore: 0 };
            if (score > snakeData.highScore) {
                snakeData.highScore = score;
                localStorage.setItem('snakeData', JSON.stringify(snakeData));
            }

            ui.style.display = 'flex';
            ui.innerHTML = `
                <div class="ui-title" style="color: #ff003c">GAME OVER</div>
                <div style="font-size: 20px; margin-bottom: 10px;">Score: ${score}</div>
                <div style="font-size: 14px; color: #888; margin-bottom: 20px;">Mejor: ${snakeData.highScore}</div>
                <button class="ui-btn" onclick="startGame()">Reintentar</button>
            `;
        }

        function game() {
            px += xv;
            py += yv;
            
            // Atravesar paredes
            if(px < 0) px = tc-1;
            if(px > tc-1) px = 0;
            if(py < 0) py = tc-1;
            if(py > tc-1) py = 0;

            // Fondo
            ctx.fillStyle = "black";
            ctx.fillRect(0,0,canvas.width,canvas.height);

            // Serpiente
            ctx.fillStyle = "#32ff7e";
            for(let i=0; i<trail.length; i++) {
                ctx.fillRect(trail[i].x*gs, trail[i].y*gs, gs-2, gs-2);
                if(trail[i].x == px && trail[i].y == py && (xv!=0 || yv!=0)) {
                    gameOver();
                    return;
                }
            }

            trail.push({x:px, y:py});
            while(trail.length > tail) {
                trail.shift();
            }

            // Manzana
            if(ax==px && ay==py) {
                tail++;
                score += 10;
                document.getElementById('score').innerText = "Score: " + score;
                ax=Math.floor(Math.random()*tc);
                ay=Math.floor(Math.random()*tc);
            }
            ctx.fillStyle = "red";
            ctx.fillRect(ax*gs, ay*gs, gs-2, gs-2);
        }

        function keyPush(evt) {
            if(!isPlaying) return;
            if([37,38,39,40].indexOf(evt.keyCode) > -1) evt.preventDefault();
            switch(evt.keyCode) {
                case 37: // Left
                    if(xv!==1) { xv=-1;yv=0; }
                    break;
                case 38: // Up
                    if(yv!==1) { xv=0;yv=-1; }
                    break;
                case 39: // Right
                    if(xv!==-1) { xv=1;yv=0; }
                    break;
                case 40: // Down
                    if(yv!==-1) { xv=0;yv=1; }
                    break;
            }
        }
    </script>
</body>
</html>